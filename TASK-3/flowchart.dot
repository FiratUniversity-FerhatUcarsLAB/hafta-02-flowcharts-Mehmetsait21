digraph HastaneSistemiAkisSemasi {
    // Grafiğin genel ayarları
    rankdir=TB; // Top to Bottom (Yukarıdan Aşağıya) akış
    node [shape=box, style="filled", fillcolor="#F4F4F4", fontname="Arial"];
    edge [fontname="Arial"];

    // Başlangıç ve Bitiş Düğümleri
    start [label="Sistem Başlangıç\n(AnaHastaneSistemi)", shape=Mdiamond, fillcolor="#CCFFCC"];
    end [label="Sistem Bitiş", shape=Mdiamond, fillcolor="#FFCCCC"];

    // Ana Akış Adımları
    kimlik_al [label="Kimlik Bilgilerini Al"];
    kimlik_dogrula [label="Kimlik Doğrulama Başarılı mı?", shape=diamond, fillcolor="#FFFFCC"];
    ana_menu [label="Ana Menü Göster\n(Randevu, Tahlil, Çıkış)", shape=box, fillcolor="#ADD8E6"];
    secim_randevu [label="Seçim = 1 (Randevu)", shape=diamond, fillcolor="#FFFFCC"];
    cikis [label="Seçim = 3 (Çıkış)", shape=diamond, fillcolor="#FFFFCC"];

    // Randevu Modülü Düğümleri (SubGraph)
    subgraph cluster_randevu {
        label = "Randevu Modülü";
        style = "rounded";
        color = "#32CD32"; // Yeşil

        randevu_start [label="RandevuModulunuCalistir", shape=box, fillcolor="#90EE90"];
        poliklinik_sec [label="Poliklinik ve Doktor Seçimi"];
        saat_uygun [label="Uygun Saat Var mı?", shape=diamond];
        onay_al [label="Randevu Onay Al", shape=diamond];
        kaydet_sms [label="Randevuyu Kaydet\n& SMS Gönder"];
        randevu_end [label="Randevu Modülü Bitiş", shape=box, fillcolor="#90EE90"];
    }

    // Tahlil Modülü Düğümleri (SubGraph)
    subgraph cluster_tahlil {
        label = "Tahlil Modülü";
        style = "rounded";
        color = "#1E90FF"; // Mavi

        tahlil_start [label="TahlilModulunuCalistir", shape=box, fillcolor="#ADD8E6"];
        tahlil_var [label="Kayıtlı Tahlil Var mı?", shape=diamond];
        sonuc_hazir [label="Sonuç Hazır mı?", shape=diamond];
        goster_indir [label="Sonucu Göster\n(PDF İndirme Opsiyonu)"];
        bekle [label="Bekleme Mesajı Göster"];
        tahlil_end [label="Tahlil Modülü Bitiş", shape=box, fillcolor="#ADD8E6"];
    }

    // ****************************
    // AKIŞ BAĞLANTILARI
    // ****************************

    // Ana Akış
    start -> kimlik_al;
    kimlik_al -> kimlik_dogrula;
    kimlik_dogrula -> ana_menu [label="Evet"];
    kimlik_dogrula -> end [label="Hayır\n(Hata Mesajı)"];

    // Ana Menü Döngüsü
    ana_menu -> secim_randevu;

    // Randevu Seçimi
    secim_randevu -> randevu_start [label="Evet"];
    secim_randevu -> cikis [label="Hayır"]; // Randevu değilse, diğer seçeneklere bak
    
    // Çıkış Kontrolü
    cikis -> end [label="Evet"];
    cikis -> tahlil_start [label="Hayır\n(Seçim=2)"]; // Eğer 3 değilse ve 1 değilse (yani 2 ise)

    // ****************************
    // Randevu Modülü Akışı
    // ****************************
    randevu_start -> poliklinik_sec;
    poliklinik_sec -> saat_uygun;
    saat_uygun -> onay_al [label="Evet"];
    saat_uygun -> randevu_end [label="Hayır\n(Hata)"];
    onay_al -> kaydet_sms [label="Evet"];
    onay_al -> randevu_end [label="Hayır\n(İptal)"];
    kaydet_sms -> randevu_end;
    randevu_end -> ana_menu [label="Geri"];

    // ****************************
    // Tahlil Modülü Akışı
    // ****************************
    tahlil_start -> tahlil_var;
    tahlil_var -> sonuc_hazir [label="Evet"];
    tahlil_var -> tahlil_end [label="Hayır\n(Hata)"];

    sonuc_hazir -> goster_indir [label="HAZIR"];
    sonuc_hazir -> bekle [label="BEKLEMEDE"];
    sonuc_hazir -> bekle [label="ONAY BEKLİYOR\nvb."];

    goster_indir -> tahlil_end;
    bekle -> tahlil_end;

    tahlil_end -> ana_menu [label="Geri"];
}
